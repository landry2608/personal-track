<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Planning Personnel">
    <meta name="application-name" content="Planning">
    <meta name="msapplication-starturl" content="index.html">
    <title>Planning Personnel</title>
    
    <link rel="apple-touch-icon" href="icon-512.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Chargement des dépendances -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Composants de base
        const Card = ({ children, className }) => (
            <div className={`bg-white rounded-lg shadow ${className}`}>{children}</div>
        );

        const CardHeader = ({ children }) => (
            <div className="p-4 border-b">{children}</div>
        );

        const CardTitle = ({ children, className }) => (
            <h2 className={`text-xl font-semibold ${className}`}>{children}</h2>
        );

        const CardContent = ({ children, className }) => (
            <div className={`p-4 ${className}`}>{children}</div>
        );

        const Button = ({ children, onClick, variant = "default", className = "", size = "default" }) => {
            const baseClasses = "inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50";
            const variants = {
                default: "bg-blue-600 text-white hover:bg-blue-700",
                ghost: "hover:bg-gray-100",
                outline: "border border-gray-300 hover:bg-gray-100",
            };
            const sizes = {
                default: "h-9 px-4 py-2",
                sm: "h-8 px-3",
                icon: "h-9 w-9",
            };
            
            return (
                <button
                    onClick={onClick}
                    className={`${baseClasses} ${variants[variant]} ${sizes[size]} ${className}`}
                >
                    {children}
                </button>
            );
        };

        const Input = ({ className = "", ...props }) => (
            <input
                className={`flex h-9 w-full rounded-md border border-gray-300 bg-transparent px-3 py-1 text-sm shadow-sm transition-colors placeholder:text-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
                {...props}
            />
        );

        const Textarea = ({ className = "", ...props }) => (
            <textarea
                className={`flex min-h-[60px] w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
                {...props}
            />
        );

        const Switch = ({ checked, onCheckedChange }) => (
            <button
                role="switch"
                aria-checked={checked}
                className={`relative inline-flex h-5 w-10 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${
                    checked ? "bg-blue-600" : "bg-gray-200"
                }`}
                onClick={() => onCheckedChange(!checked)}
            >
                <span
                    className={`pointer-events-none block h-4 w-4 rounded-full bg-white shadow-lg ring-0 transition-transform ${
                        checked ? "translate-x-5" : "translate-x-1"
                    }`}
                />
            </button>
        );

        // Icônes SVG
        const SaveIcon = () => (
            <svg className="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
            </svg>
        );

        const PlusIcon = () => (
            <svg className="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const CheckCircleIcon = () => (
            <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );

        const XCircleIcon = () => (
            <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
        );

        // Composant principal MobileTracker
        function MobileTracker() {
            const createEmptyCategory = () => ({
                objectif: '',
                realisation: '',
                status: ''
            });

            const [categories, setCategories] = useState([
                'famille',
                'sante',
                'entrepreneuriat'
            ]);
            const [activeTab, setActiveTab] = useState('today');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [currentData, setCurrentData] = useState({});
            const [notificationsEnabled, setNotificationsEnabled] = useState(false);
            const [editingCategory, setEditingCategory] = useState(null);
            const [newCategoryName, setNewCategoryName] = useState('');
            const [isAddingCategory, setIsAddingCategory] = useState(false);

            // Chargement des données
            useEffect(() => {
                const savedCategories = localStorage.getItem('categories');
                if (savedCategories) {
                    setCategories(JSON.parse(savedCategories));
                }

                const savedData = localStorage.getItem(`tracker_${selectedDate}`);
                if (savedData) {
                    setCurrentData(JSON.parse(savedData));
                } else {
                    const newData = categories.reduce((acc, category) => {
                        acc[category] = createEmptyCategory();
                        return acc;
                    }, {});
                    newData.reflexion = '';
                    setCurrentData(newData);
                }
            }, [selectedDate]);

            // Fonctions de gestion
            const handleTaskChange = (category, field, value) => {
                setCurrentData(prev => {
                    if (category === 'reflexion') {
                        return { ...prev, reflexion: value };
                    }
                    return {
                        ...prev,
                        [category]: {
                            ...prev[category],
                            [field]: value
                        }
                    };
                });
            };

            const handleAddCategory = () => {
                if (newCategoryName.trim() && !categories.includes(newCategoryName.trim().toLowerCase())) {
                    const updatedCategories = [...categories, newCategoryName.trim().toLowerCase()];
                    setCategories(updatedCategories);
                    localStorage.setItem('categories', JSON.stringify(updatedCategories));
                    
                    setCurrentData(prev => ({
                        ...prev,
                        [newCategoryName.trim().toLowerCase()]: createEmptyCategory()
                    }));
                    
                    setNewCategoryName('');
                    setIsAddingCategory(false);
                }
            };

            const startEditingCategory = (category) => {
                setEditingCategory(category);
                setNewCategoryName(category);
            };

            const handleEditCategory = () => {
                if (newCategoryName.trim() && editingCategory && newCategoryName.trim().toLowerCase() !== editingCategory) {
                    const updatedCategories = categories.map(cat => 
                        cat === editingCategory ? newCategoryName.trim().toLowerCase() : cat
                    );
                    setCategories(updatedCategories);
                    localStorage.setItem('categories', JSON.stringify(updatedCategories));

                    const updatedData = { ...currentData };
                    updatedData[newCategoryName.trim().toLowerCase()] = updatedData[editingCategory];
                    delete updatedData[editingCategory];
                    setCurrentData(updatedData);

                    Object.keys(localStorage)
                        .filter(key => key.startsWith('tracker_'))
                        .forEach(key => {
                            const dayData = JSON.parse(localStorage.getItem(key));
                            if (dayData[editingCategory]) {
                                dayData[newCategoryName.trim().toLowerCase()] = dayData[editingCategory];
                                delete dayData[editingCategory];
                                localStorage.setItem(key, JSON.stringify(dayData));
                            }
                        });

                    setEditingCategory(null);
                    setNewCategoryName('');
                }
            };

            const calculateCategoryStats = (category) => {
                const stats = {
                    achieved: 0,
                    notAchieved: 0,
                    successRate: 0,
                    creationDate: '',
                    deletionDate: null
                };

                Object.keys(localStorage)
                    .filter(key => key.startsWith('tracker_'))
                    .sort()
                    .forEach(key => {
                        try {
                            const dayData = JSON.parse(localStorage.getItem(key));
                            if (dayData[category]) {
                                if (!stats.creationDate) {
                                    stats.creationDate = key.replace('tracker_', '');
                                }
                                if (dayData[category].status === 'Atteint') {
                                    stats.achieved++;
                                } else if (dayData[category].status === 'Non atteint') {
                                    stats.notAchieved++;
                                }
                            }
                        } catch (error) {
                            console.error('Erreur lors de la lecture des données:', error);
                        }
                    });

                const total = stats.achieved + stats.notAchieved;
                stats.successRate = total > 0 ? Math.round((stats.achieved / total) * 100) : 0;

                return stats;
            };

            const handleDeleteCategory = (categoryToDelete) => {
                const updatedCategories = categories.filter(cat => cat !== categoryToDelete);
                setCategories(updatedCategories);
                localStorage.setItem('categories', JSON.stringify(updatedCategories));

                const updatedData = { ...currentData };
                delete updatedData[categoryToDelete];
                setCurrentData(updatedData);
            };

            const saveData = () => {
                localStorage.setItem(`tracker_${selectedDate}`, JSON.stringify(currentData));
            };

            // Rendu des vues
            const renderTodayView = () => (
                <div className="space-y-4">
                    <div className="flex items-center justify-between mb-4">
                        <Input
                            type="date"
                            value={selectedDate}
                            onChange={(e) => setSelectedDate(e.target.value)}
                            className="w-40"
                        />
                    </div>
                    
                    {categories.map(category => (
                        <Card key={category} className="mb-4">
                            <CardHeader>
                                {editingCategory === category ? (
                                    <div className="flex items-center gap-2">
                                        <Input
                                            value={newCategoryName}
                                            onChange={(e) => setNewCategoryName(e.target.value)}
                                            className="flex-1"
                                        />
                                        <Button onClick={handleEditCategory} size="sm">
                                            Valider
                                        </Button>
                                        <Button 
                                            variant="outline" 
                                            size="sm"
                                            onClick={() => {
                                                setEditingCategory(null);
                                                setNewCategoryName('');
                                            }}
                                        >
                                            Annuler
                                        </Button>
                                    </div>
                                ) : (
                                    <div className="flex items-center justify-between">
                                        <CardTitle className="text-lg font-semibold capitalize">
                                            {category}
                                        </CardTitle>
                                        <div className="flex gap-2">
                                            <Button
                                                variant="ghost"
                                                size="icon"
                                                onClick={() => startEditingCategory(category)}
                                                className="h-8 w-8"
                                            >
                                                <svg className="h-4 w-4 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3Z"/>
                                                </svg>
                                            </Button>
                                            <Button
                                                variant="ghost"
                                                size="icon"
                                                onClick={() => handleDeleteCategory(category)}
                                                className="h-8 w-8"
                                            >
                                                <svg className="h-4 w-4 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                    <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                                </svg>
                                            </Button>
                                        </div>
                                    </div>
                                )}
                            </CardHeader>
                          <CardContent className="space-y-4">
                                <div>
                                    <label className="text-sm font-medium">Objectif</label>
                                    <Input
                                        value={currentData[category]?.objectif || ''}
                                        onChange={(e) => handleTaskChange(category, 'objectif', e.target.value)}
                                        placeholder={`Objectif ${category}`}
                                        className="mt-1"
                                    />
                                </div>
                                <div>
                                    <label className="text-sm font-medium">Réalisation</label>
                                    <Input
                                        value={currentData[category]?.realisation || ''}
                                        onChange={(e) => handleTaskChange(category, 'realisation', e.target.value)}
                                        placeholder="Ce que j'ai accompli"
                                        className="mt-1"
                                    />
                                </div>
                                <div>
                                    <label className="text-sm font-medium mb-2 block">Statut</label>
                                    <div className="flex gap-2">
                                        <Button
                                            variant={currentData[category]?.status === 'Atteint' ? "default" : "outline"}
                                            onClick={() => handleTaskChange(category, 'status', 'Atteint')}
                                            className="flex items-center gap-2"
                                        >
                                            <CheckCircleIcon />
                                            Atteint
                                        </Button>
                                        <Button
                                            variant={currentData[category]?.status === 'Non atteint' ? "default" : "outline"}
                                            onClick={() => handleTaskChange(category, 'status', 'Non atteint')}
                                            className="flex items-center gap-2"
                                        >
                                            <XCircleIcon />
                                            Non atteint
                                        </Button>
                                    </div>
                                </div>
                            </CardContent>
                        </Card>
                    ))}

                    {isAddingCategory ? (
                        <Card className="mb-4">
                            <CardContent className="pt-4">
                                <div className="flex gap-2">
                                    <Input
                                        value={newCategoryName}
                                        onChange={(e) => setNewCategoryName(e.target.value)}
                                        placeholder="Nom de la nouvelle catégorie"
                                        className="flex-1"
                                    />
                                    <Button onClick={handleAddCategory}>Ajouter</Button>
                                    <Button 
                                        variant="outline" 
                                        onClick={() => {
                                            setIsAddingCategory(false);
                                            setNewCategoryName('');
                                        }}
                                    >
                                        Annuler
                                    </Button>
                                </div>
                            </CardContent>
                        </Card>
                    ) : (
                        <Button
                            onClick={() => setIsAddingCategory(true)}
                            className="w-full mb-4"
                            variant="outline"
                        >
                            <PlusIcon />
                            Ajouter une catégorie
                        </Button>
                    )}

                    <Card>
                        <CardHeader>
                            <CardTitle className="text-lg font-semibold">Réflexion</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <Textarea
                                value={currentData.reflexion || ''}
                                onChange={(e) => handleTaskChange('reflexion', '', e.target.value)}
                                placeholder="Ce que je retiens de ma journée..."
                                className="min-h-24"
                            />
                        </CardContent>
                    </Card>

                    <Button onClick={saveData} className="w-full">
                        <SaveIcon />
                        Sauvegarder
                    </Button>
                </div>
            );

            const renderStatsView = () => (
                <div className="space-y-4">
                    <Card>
                        <CardHeader>
                            <CardTitle>Statistiques des objectifs</CardTitle>
                        </CardHeader>
                        <CardContent>
                            {categories.map(category => {
                                const stats = calculateCategoryStats(category);
                                return (
                                    <div key={category} className="mb-4">
                                        <h3 className="font-medium capitalize mb-2">{category}</h3>
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p>Objectifs atteints: {stats.achieved}</p>
                                                <p>Objectifs non atteints: {stats.notAchieved}</p>
                                                <p>Taux de réussite: {stats.successRate}%</p>
                                            </div>
                                            <div>
                                                <p>Date de création: {stats.creationDate}</p>
                                                {stats.deletionDate && (
                                                    <p>Date de suppression: {stats.deletionDate}</p>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </CardContent>
                    </Card>
                </div>
            );

            return (
                <div className="flex flex-col h-screen bg-gray-50">
                    <header className="bg-blue-600 text-white p-4">
                        <h1 className="text-xl font-bold text-center">Planning Personnel</h1>
                    </header>
                    
                    <main className="flex-1 overflow-y-auto p-4">
                        {activeTab === 'today' && renderTodayView()}
                        {activeTab === 'stats' && renderStatsView()}
                        {activeTab === 'settings' && (
                            <div className="space-y-4">
                                <Card>
                                    <CardHeader>
                                        <CardTitle className="text-lg">Réglages</CardTitle>
                                    </CardHeader>
                                    <CardContent>
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h3 className="font-medium">Rappel quotidien</h3>
                                                <p className="text-sm text-gray-500">
                                                    Notification à 21h00 pour planifier vos objectifs
                                                </p>
                                            </div>
                                            <Switch
                                                checked={notificationsEnabled}
                                                onCheckedChange={setNotificationsEnabled}
                                            />
                                        </div>
                                    </CardContent>
                                </Card>
                            </div>
                        )}
                    </main>
                    
                    <nav className="border-t border-gray-200 bg-white">
                        <div className="flex justify-around p-2">
                            <Button
                                variant={activeTab === 'today' ? 'default' : 'ghost'}
                                onClick={() => setActiveTab('today')}
                                className="flex-1 flex flex-col items-center py-2"
                            >
                                <svg className="w-5 h-5 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                    <polyline points="9 22 9 12 15 12 15 22"/>
                                </svg>
                                <span className="text-xs">Aujourd'hui</span>
                            </Button>
                            <Button
                                variant={activeTab === 'stats' ? 'default' : 'ghost'}
                                onClick={() => setActiveTab('stats')}
                                className="flex-1 flex flex-col items-center py-2"
                            >
                                <svg className="w-5 h-5 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                    <line x1="18" y1="20" x2="18" y2="10"/>
                                    <line x1="12" y1="20" x2="12" y2="4"/>
                                    <line x1="6" y1="20" x2="6" y2="14"/>
                                </svg>
                                <span className="text-xs">Statistiques</span>
                            </Button>
                            <Button
                                variant={activeTab === 'settings' ? 'default' : 'ghost'}
                                onClick={() => setActiveTab('settings')}
                                className="flex-1 flex flex-col items-center py-2"
                            >
                                <svg className="w-5 h-5 mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                                </svg>
                                <span className="text-xs">Réglages</span>
                            </Button>
                        </div>
                    </nav>
                </div>
            );
        }

        // Rendu de l'application
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MobileTracker />);
    </script>
</body>
</html>
